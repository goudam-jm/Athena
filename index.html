<!DOCTYPE html>
<html>
	<head>
		<title>Athena - FB feed filter</title>
		<meta charset="UTF-8">
	</head>
	<body>
		<div id="fb-root"></div>
		<script>
			function statusChangeCallback(response){
				console.log('Status changed');
				console.log(response);

				if(response.status == 'connected'){
					testAPI();
				}
				else if(response.status == 'not_authorized'){
					document.getElementById('status').innerHTML = 'Please authorize Athena to access your Facebook data';
				}
				else{
					document.getElementById('status').innerHTML = 'Please log into Facebook';
				}
			}

			function checkLoginState(){
				FB.getLoginStatus(function(response){
					statusChangeCallback(response);
				});
			}

			window.fbAsyncInit = function(){
				FB.init({
					appId: '674259795986232',
					cookie:true,
					xfbml:true,
					version:'v2.0'
				});

				FB.getLoginStatus(function(response){
					statusChangeCallback(response);
				});
			};

			(function(d,s,id){
				var js,fjs = d.getElementsByTagName(s)[0];
				if(d.getElementById(id)){return;}
				js = d.createElement(s);js.id = id;
				js.src = "//connect.facebook.net/en_US/sdk.js";
				fjs.parentNode.insertBefore(js,fjs);
			}(document,'script','facebook-jssdk'));

			function testAPI(){
				console.log('Welcome to Athena! Fetching your information...');
				FB.api('/me',function(response){
					console.log('Successful login for '+response.name);
					var user_name = response.name, user_id = response.id;
					FB.api('/me/feed',function(response){
						if(response && !response.error){
							console.log(response.message);
							var response_data = response.data;
							document.getElementById('status').innerHTML = "";
							for(var i=0;i<response_data.length;++i){
								var resp = response_data[i],content = resp.story || resp.message || "";
								if(content !== ""){
									var from = resp.from.name;
									document.getElementById('status').innerHTML += '<div><h3>From:'+from+'</h3><p>'+content+'</p></div>';
								}
							}
						}
					})
				})
			}
		</script>

		<div class="fb-login-button" data-size="xlarge" data-max-rows="3" data-show-faces="true" data-auto-logout-link="true" data-scope="read_stream" onlogin="checkLoginState();"></div>

		<div id="status"></div>
	</body>
</html>